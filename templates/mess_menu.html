{% extends "base.html" %}
{% block content %}
<h2 class="text-center mb-4 fw-bold text-primary">üç¥ Weekly Mess Menu</h2>

<div class="table-wrapper">
    <table class="table text-center align-middle mess-menu">
        <thead>
            <tr>
                <th>Day</th>
                <th>ü•û Breakfast</th>
                <th>ü•ó Lunch</th>
                <th>üçΩÔ∏è Dinner</th>
            </tr>
        </thead>
        <tbody>
            {% for day in days %}
            <tr>
                <td class="day-col">{{ day.capitalize() }}</td>
                <td class="meal-cell breakfast" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}" data-label="Breakfast">{{ menu[day]['breakfast'] }}</td>
                <td class="meal-cell lunch" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}" data-label="Lunch">{{ menu[day]['lunch'] }}</td>
                <td class="meal-cell dinner" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}" data-label="Dinner">{{ menu[day]['dinner'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if current_user.is_admin %}
<div class="text-center mt-4">
    <button id="saveMenuBtn" class="btn btn-custom px-4">üíæ Save Menu</button>
</div>

<script>
document.getElementById("saveMenuBtn").addEventListener("click", function() {
    const table = document.querySelector("table");
    const days = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];
    const meals = ["breakfast","lunch","dinner"];
    let updatedMenu = {};

    for (let i = 1; i <= days.length; i++) {
        const row = table.rows[i];
        let day = days[i-1];
        updatedMenu[day] = {};
        meals.forEach((meal, j) => {
            updatedMenu[day][meal] = row.cells[j+1].innerText.trim();
        });
    }

    fetch("{{ url_for('update_menu') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedMenu)
    })
    .then(res => res.json())
    .then(data => alert(data.message))
    .catch(err => alert("Error saving menu!"));
});
</script>
{% endif %}

<style>
/* Base table */
.mess-menu {
    border-collapse: separate;
    border-spacing: 0 12px;
    width: 100%;
    font-family: 'Poppins', sans-serif;
}

/* Table headers */
.mess-menu thead th {
    background: #3498db;
    color: #fff;
    font-weight: 600;
    padding: 14px;
    border: none;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-radius: 10px 10px 0 0;
    font-size: 0.95rem;
}

/* Row cards */
.mess-menu tbody tr {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.mess-menu tbody tr:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}

/* Table cells */
.mess-menu td {
    padding: 14px;
    border: none;
    font-size: 0.95rem;
    color: #444;
}

/* Day column */
.day-col {
    font-weight: 700;
    font-size: 1.05rem;
    color: #2c3e50;
    letter-spacing: 0.5px;
}

/* Editable cells */
.mess-menu td[contenteditable="true"] {
    cursor: text;
    border-radius: 6px;
    font-weight: 400;
    color: #555;
    transition: background 0.2s ease, box-shadow 0.2s ease;
}

.mess-menu td[contenteditable="true"]:hover {
    background-color: #f9f9f9;
}

.mess-menu td[contenteditable="true"]:focus {
    outline: 2px solid #3498db;
    background-color: #eef7ff;
    box-shadow: inset 0 0 6px rgba(52,152,219,0.2);
}

/* Meal color accents */
.breakfast {
    background: #fffaf2;
}
.lunch {
    background: #f7fff5;
}
.dinner {
    background: #f9f7ff;
}

/* Mobile responsive cards */
@media (max-width: 768px) {
    .mess-menu, .mess-menu thead, .mess-menu tbody, .mess-menu th, .mess-menu td, .mess-menu tr {
        display: block;
        width: 100%;
    }

    .mess-menu thead {
        display: none;
    }

    .mess-menu tbody tr {
        margin-bottom: 1.5rem;
        border-radius: 12px;
        overflow: hidden;
    }

    .mess-menu td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.95rem;
    }

    .mess-menu td:last-child {
        border-bottom: none;
    }

    .mess-menu td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #3498db;
        margin-right: 10px;
    }

    .day-col {
        font-size: 1.2rem;
        background: #f4faff;
        padding: 14px;
        color: #2c3e50;
    }
}
</style>
{% endblock %}

{% extends "base.html" %}
{% block content %}
<h2 class="text-center mb-4 fw-bold text-primary">üç¥ Weekly Mess Menu</h2>

<div class="accordion" id="messMenuAccordion">
    {% for day in days %}
    <div class="accordion-item shadow-sm mb-3 rounded-3 border-0">
        <h2 class="accordion-header" id="heading-{{ day }}">
            <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ day }}" aria-expanded="false" aria-controls="collapse-{{ day }}">
                {{ day.capitalize() }}
            </button>
        </h2>
        <div id="collapse-{{ day }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ day }}" data-bs-parent="#messMenuAccordion">
            <div class="accordion-body">
                <div class="card border-0 mb-2">
                    <div class="card-body meal-card breakfast">
                        <h6 class="fw-bold text-secondary">ü•û Breakfast</h6>
                        <p class="meal-text" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}">{{ menu[day]['breakfast'] }}</p>
                    </div>
                </div>
                <div class="card border-0 mb-2">
                    <div class="card-body meal-card lunch">
                        <h6 class="fw-bold text-secondary">ü•ó Lunch</h6>
                        <p class="meal-text" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}">{{ menu[day]['lunch'] }}</p>
                    </div>
                </div>
                <div class="card border-0">
                    <div class="card-body meal-card dinner">
                        <h6 class="fw-bold text-secondary">üçΩÔ∏è Dinner</h6>
                        <p class="meal-text" contenteditable="{{ 'true' if current_user.is_admin else 'false' }}">{{ menu[day]['dinner'] }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if current_user.is_admin %}
<div class="text-center mt-4">
    <button id="saveMenuBtn" class="btn btn-custom px-4">üíæ Save Menu</button>
</div>

<script>
document.getElementById("saveMenuBtn").addEventListener("click", function() {
    const days = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];
    const meals = ["breakfast","lunch","dinner"];
    let updatedMenu = {};

    days.forEach(day => {
        updatedMenu[day] = {};
        meals.forEach(meal => {
            const el = document.querySelector(`#collapse-${day} .${meal} .meal-text`);
            updatedMenu[day][meal] = el.innerText.trim();
        });
    });

    fetch("{{ url_for('update_menu') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedMenu)
    })
    .then(res => res.json())
    .then(data => alert(data.message))
    .catch(err => alert("Error saving menu!"));
});
</script>
{% endif %}

<style>
.accordion-button {
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    background: #f4f9ff;
    color: #2c3e50;
    border-radius: 8px !important;
    transition: all 0.2s ease;
}

.accordion-button:not(.collapsed) {
    background: #3498db;
    color: #fff;
    box-shadow: none;
}

.meal-card {
    background: #fff;
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.meal-card h6 {
    margin-bottom: 6px;
}

.meal-text {
    margin: 0;
    font-size: 0.95rem;
    color: #444;
    min-height: 24px;
    cursor: default;
}

.meal-text[contenteditable="true"] {
    cursor: text;
    border-radius: 6px;
    padding: 4px 6px;
    transition: background 0.2s ease;
}

.meal-text[contenteditable="true"]:hover {
    background-color: #f9f9f9;
}

.meal-text[contenteditable="true"]:focus {
    outline: 2px solid #3498db;
    background-color: #eef7ff;
}

/* Subtle background per meal */
.breakfast { background: #fffaf2; }
.lunch { background: #f7fff5; }
.dinner { background: #f9f7ff; }
</style>
{% endblock %}

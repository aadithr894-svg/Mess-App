{% extends "base.html" %}
{% block content %}

<div class="container my-4" style="max-width: 700px;">

    <div class="card shadow-lg border-0 rounded-4 mb-5 theme-card">
        <div class="card-header text-center rounded-top-4 theme-card-header">
            <h3 class="mb-0 fw-bold" style="color: var(--primary);">
                <i class="fas fa-ban me-2"></i> Apply Mess Skip
            </h3>
        </div>
        <div class="card-body p-4 p-md-5">
            <form method="POST">
                <div class="mb-4">
                    <label for="skip_date" class="form-label fw-bold" style="color: var(--primary);">
                        <i class="fas fa-calendar-alt me-1"></i> Date of Skip:
                    </label>
                    <input type="date"
                            name="skip_date"
                            id="skip_date"
                            required
                            class="form-control form-control-lg rounded-3 shadow-sm theme-input"
                            onkeydown="return false;">
                    <small class="form-text text-muted">
                        *Skips must be requested at least one day in advance (before 10 PM).
                    </small>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold" style="color: var(--primary);">
                        <i class="fas fa-utensils me-1"></i> Meals to Skip:
                    </label>
                    <div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-4 mt-2">
                        {% for meal, icon in [('breakfast', 'üç≥'), ('lunch', 'üçõ'), ('dinner', 'üç≤'), ('snacks', '‚òï')] %}
                        <div class="form-check form-switch form-check-lg">
                            <input class="form-check-input theme-switch" type="checkbox" name="{{ meal }}" id="{{ meal }}">
                            <label class="form-check-label fw-medium" for="{{ meal }}">
                                {{ icon }} {{ meal|capitalize }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-lg w-75 rounded-pill shadow-lg theme-submit-btn">
                        <i class="fas fa-check me-2"></i> Confirm Skip
                    </button>
                </div>
            </form>
        </div>
    </div>

    <h4 class="fw-bold text-center mb-4" style="color: var(--primary);">
        <i class="fas fa-clipboard-list me-2"></i> My Recent Mess Skips
    </h4>
    {% if skips %}
        <ul class="list-group shadow-sm rounded-3">
            {% for s in skips %}
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap theme-list-item">
                    <div class="py-1">
                        <strong style="color: var(--text-color);">{{ s.skip_date }}</strong><br>
                        <small class="text-muted">
                            <i class="fas fa-utensils me-1" style="color: var(--primary);"></i> {{ s.meal_type|capitalize }}
                        </small>
                    </div>
                    <span class="badge rounded-pill fw-medium bg-primary text-white">
                        SKIP APPLIED
                    </span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="alert text-center rounded-3" style="background-color: var(--sidebar-hover); color: var(--text-color);">
            <i class="fas fa-mug-hot me-1" style="color: var(--primary);"></i> You haven‚Äôt applied for any mess skips yet. Ready to save?
        </div>
    {% endif %}

</div>

<style>
/* Card and Header */
.theme-card {
    border: 1px solid var(--border-light) !important;
}
.theme-card-header {
    background-color: var(--sidebar-hover) !important; /* Soft Gray Header */
    padding: 1.25rem 1.5rem;
}

/* Form Inputs */
.theme-input {
    border-color: var(--border-light);
    transition: border-color 0.3s, box-shadow 0.3s;
}
.theme-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.25); /* Navy focus ring */
}

/* Custom Switch for Checkboxes */
.form-check-lg {
    min-height: 1.5rem;
}
.theme-switch {
    width: 2.5em; /* Wider switch */
    height: 1.5em;
    cursor: pointer;
    background-color: var(--border-light); /* Off state color: Light gray */
    border-color: var(--border-light);
}
.theme-switch:checked {
    background-color: var(--primary); /* On state: Navy Blue */
    border-color: var(--primary);
}
.theme-switch:focus {
    box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.25); /* Navy focus ring */
}

/* Submit Button */
.theme-submit-btn {
    background-color: var(--primary);
    border-color: var(--primary);
    color: white;
    font-weight: 600;
    transition: background-color 0.3s, transform 0.3s;
}
.theme-submit-btn:hover {
    background-color: #34495E; /* Slightly darker Navy */
    border-color: #34495E;
    transform: translateY(-2px);
}

/* List Items */
.theme-list-item {
    background-color: var(--card-bg);
    border-left: 5px solid var(--primary); /* Navy Accent line */
    margin-bottom: 8px;
    border-radius: var(--radius) !important;
}
/* Ensure default list item border is subtle */
.list-group-item {
    border-color: var(--border-light);
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const dateInput = document.getElementById("skip_date");
    const now = new Date();
    
    // Calculate 10 PM today (22 hours)
    const deadlineToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 22, 0, 0);

    let minDate;
    
    // If current time is before 10 PM (22:00) today, the minimum skip date is tomorrow.
    if (now < deadlineToday) {
        const tomorrow = new Date(now);
        tomorrow.setDate(now.getDate() + 1);
        minDate = tomorrow;
    } 
    // If current time is after 10 PM (22:00) today, the minimum skip date is the day after tomorrow.
    else {
        const dayAfterTomorrow = new Date(now);
        dayAfterTomorrow.setDate(now.getDate() + 2);
        minDate = dayAfterTomorrow;
    }

    // Set min attribute for the date picker
    dateInput.setAttribute("min", minDate.toISOString().split("T")[0]);
    
    // Prevent manual keyboard entry (already in original code)
    dateInput.addEventListener("keydown", e => e.preventDefault());
});
</script>
{% endblock %}
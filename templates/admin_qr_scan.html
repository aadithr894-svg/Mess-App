<h3 id="liveCount" style="margin-top:20px; color:blue;">Live Count: 0</h3>

<button id="addCountBtn" class="btn btn-success mt-3">➕ Add Count</button>

<script>
function detectMeal() {
    const now = new Date();
    const hours = now.getHours() + now.getMinutes()/60;
    if(hours >= 7.5 && hours <= 9) return 'breakfast';
    if(hours >= 12 && hours <= 14) return 'lunch';
    return 'dinner';
}

function updateLiveCount() {
    const meal = detectMeal();
    fetch(`/admin/live_count/${meal}`)
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById("liveCount").innerText =
              `Live Count (${meal}): ${data.count}`;
        }
    });
}

// refresh live count every 3s
setInterval(updateLiveCount, 3000);
updateLiveCount();

document.getElementById("addCountBtn").addEventListener("click", function() {
    const meal = detectMeal();
    fetch("/admin/add_count", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ meal_type: meal })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert(`✅ Saved: ${data.total_people} people for ${data.meal_type} (${data.count_date})`);
            updateLiveCount(); // resets to 0 after saving
        } else {
            alert("❌ " + data.message);
        }
    })
    .catch(err => console.error(err));
});
</script>

{% extends "admin_base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>ðŸ“Š Mess Attendance Counts</h2>
  <p>These are the <b>confirmed</b> totals saved from the QR Scanner page when you click <i>Add Count</i>.</p>
  <hr>

  <table class="table table-bordered table-striped text-center">
    <thead>
      <tr>
        <th>Date</th>
        <th>Breakfast</th>
        <th>Lunch</th>
        <th>Dinner</th>
      </tr>
    </thead>
    <tbody>
      {% for date, meals in counts_by_date.items() %}
      <tr>
        <td>{{ date }}</td>
        <td>{{ meals.get('breakfast', 0) }}</td>
        <td>{{ meals.get('lunch', 0) }}</td>
        <td>{{ meals.get('dinner', 0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Optional Chart -->
  <canvas id="mealChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ counts_by_date.keys()|list|tojson }};
  const breakfastData = {{ [meals.get('breakfast', 0) for meals in counts_by_date.values()]|tojson }};
  const lunchData = {{ [meals.get('lunch', 0) for meals in counts_by_date.values()]|tojson }};
  const dinnerData = {{ [meals.get('dinner', 0) for meals in counts_by_date.values()]|tojson }};

  new Chart(document.getElementById('mealChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        { label: 'Breakfast', data: breakfastData, borderColor: '#36A2EB', fill: false },
        { label: 'Lunch', data: lunchData, borderColor: '#FFCE56', fill: false },
        { label: 'Dinner', data: dinnerData, borderColor: '#FF6384', fill: false }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: "Daily Meal Attendance" }
      }
    }
  });
</script>
{% endblock %}

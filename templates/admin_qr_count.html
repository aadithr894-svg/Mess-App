{% extends "admin_base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>üìä Mess Attendance Counts</h2>
  <p>Shows confirmed totals (after clicking ‚ÄúAdd Count‚Äù in scanner page).</p>
  <hr>

  <!-- Table of daily counts -->
  <table class="table table-bordered table-striped text-center">
    <thead>
      <tr>
        <th>Date</th>
        <th>Breakfast</th>
        <th>Lunch</th>
        <th>Dinner</th>
      </tr>
    </thead>
    <tbody>
      {% for date, meals in counts_by_date.items() %}
      <tr>
        <td>{{ date }}</td>
        <td>{{ meals.get('breakfast', 0) }}</td>
        <td>{{ meals.get('lunch', 0) }}</td>
        <td>{{ meals.get('dinner', 0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Chart -->
  <div class="mt-4">
    <canvas id="mealChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Data passed from Flask
  const labels = {{ dates|tojson }};
  const breakfastData = {{ breakfast_data|tojson }};
  const lunchData = {{ lunch_data|tojson }};
  const dinnerData = {{ dinner_data|tojson }};

  new Chart(document.getElementById('mealChart'), {
    type: 'line',  // change to 'bar' if you prefer
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Breakfast',
          data: breakfastData,
          borderColor: '#36A2EB',
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          fill: true,
        },
        {
          label: 'Lunch',
          data: lunchData,
          borderColor: '#FFCE56',
          backgroundColor: 'rgba(255, 206, 86, 0.2)',
          fill: true,
        },
        {
          label: 'Dinner',
          data: dinnerData,
          borderColor: '#FF6384',
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          fill: true,
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: "Daily Meal Attendance" }
      }
    }
  });
</script>
{% endblock %}

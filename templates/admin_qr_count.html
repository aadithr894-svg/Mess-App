{% extends "admin_base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>ðŸ“Š QR Scan Counts ({{ today }})</h2>
  <hr>

  <!-- Todayâ€™s Meal Counts -->
  <h4>Todayâ€™s Meal Totals</h4>
  <canvas id="mealChart"></canvas>

  <hr>

  <!-- Per-user Scan Totals -->
  <h4>Per User Scan Totals</h4>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Course</th>
        <th>Total Scans</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ u.name }}</td>
        <td>{{ u.course }}</td>
        <td>{{ u.total_scans }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const mealData = {
    labels: ["Breakfast", "Lunch", "Dinner"],
    datasets: [{
      label: 'Scans',
      data: [
        {{ meal_counts.breakfast[0].total_users if meal_counts.breakfast else 0 }},
        {{ meal_counts.lunch[0].total_users if meal_counts.lunch else 0 }},
        {{ meal_counts.dinner[0].total_users if meal_counts.dinner else 0 }}
      ],
      backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384'],
    }]
  };

  new Chart(document.getElementById('mealChart'), {
    type: 'bar',
    data: mealData,
    options: {
      responsive: true,
      plugins: {
        legend: { display: true, position: 'top' },
        title: { display: true, text: "Meal Scan Counts" }
      }
    }
  });
</script>
{% endblock %}
